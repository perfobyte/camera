(()=>{var _e=document.getElementById("cm_sh"),v=document.getElementById("camera"),a=v.classList,w=_e.classList,F=_e.querySelector("button"),ve=document.getElementById("cm_aud"),L=ve.classList,W=ve.querySelector("ul"),De=document.getElementById("cm_au"),E=De.classList,xe=document.querySelector("#tmpl .audv"),h=document.getElementById("cm_ts"),qe=h.classList,D=document.getElementById("cm_pl").classList,Be=document.getElementById("cm_pa"),r=v.querySelector("video"),z=document.querySelector("#cm_ce > :nth-child(1)"),G=document.querySelector("#cm_ce > :nth-child(2)"),J=document.getElementById("ap").children,S=J[2];var g=()=>D.add("hi");var k=()=>r.paused?r.play():r.pause();var K=(e,t)=>e+(t.kind==="videoinput");var Q=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`;var s=[0,0];var d=(e=>({m:(e=localStorage.getItem("3"))?parseInt(e):(localStorage.setItem("3","0"),0),vd:localStorage.getItem("2")||"",md:localStorage.getItem("4")||""}))("");var o={stream:null,rd:null,paused:!1,T:null,o:null};var O=e=>h.textContent=Q(++s[0]);var U="video/webm; codecs=vp8,opus",he="video/webm; codecs=vp8",u={exact:""},n={exact:""},ge={name:"camera"},ke={name:"microphone"},_={a:null},q={a:null,b:null},ye={video:!0,audio:!0},be={video:!0,audio:!1},b={type:U},I={mimeType:U},Ue={deviceId:n},Ie={deviceId:u},B={video:Ie,audio:!1},C={video:Ie,audio:Ue};var X=()=>{var e=o.rd;return a.add("c"),a.remove("f"),o.rd=e.onstop=e.ondataavailable=null,clearInterval(s[1]),o.stream=r.srcObject,r.srcObject=null,v.addEventListener("click",k),r.addEventListener("pause",x),r.addEventListener("play",g),x(),r.src=URL.createObjectURL(new Blob(_.a,b)),r.pause()};var x=()=>D.remove("hi");var Y=e=>{var t=e.state;return t==="granted"?(u.exact=d.vd,navigator.mediaDevices.enumerateDevices().then(A)):t==="prompt"?navigator.mediaDevices.getUserMedia(q.a).then(Z).then(A):console.error("access denied")};var ee=e=>{var t=e.state;return q.a=t==="denied"?(I.mimeType=b.type=he,o.o=B,be):(n.exact=d.md,o.o=C,ye),navigator.permissions.query(ge).then(Y)};var p=(e,t)=>(t.stop(),e.removeTrack(t),e);var T=(e,t)=>(e.addTrack(t),e);var te=e=>{var t=r.srcObject;return t.getVideoTracks().reduce(p,t),e.getVideoTracks().reduce(T,t),e.getAudioTracks().reduce(p,e)};var re=e=>(a.add("a"),r.srcObject=e);var oe=()=>(o.paused=!o.paused)?(o.rd.pause(),clearInterval(s[1]),a.add("p")):(o.rd.resume(),s[1]=setInterval(O,1e3),a.remove("p"));var ae=e=>(w.add("b"),navigator.mediaDevices.enumerateDevices().then(ce).finally(me));var de=e=>{var t=d.m;return J[t].click()};var ie=function(){return o.T=this.classList,localStorage.setItem("4",d.md=n.exact=this.getAttribute("data-a")),navigator.mediaDevices.getUserMedia(C).then(le).catch(console.error)};var pe=e=>L.contains("a")?L.remove("a"):navigator.mediaDevices.enumerateDevices().then(se);var ue=()=>(I.mimeType=b.type=U,navigator.permissions.query(ke).then(ee).catch(console.error));var fe=()=>{var e=r.srcObject;return r.srcObject=null,e.getTracks().reduce(p,e),a.remove("a")};var Le=e=>(a.add("c"),e.stopPropagation(),r.pause());var Ee=e=>{var t=o.rd;return t===null?(_.a=[],o.paused=!1,a.remove("p"),(t=new MediaRecorder(r.srcObject,I)).ondataavailable=ne,t.onstop=X,a.add("f"),s[0]=0,s[1]=setInterval(O,1e3),(o.rd=t).start()):t.stop()};var R=[Le,Ee];var Se=e=>(e.stopPropagation(),S.getContext("2d").drawImage(r,0,0,S.width=r.videoWidth,S.height=r.videoHeight),((t,m)=>{m.appendChild(t),t.href=S.toDataURL("image/jpeg",1),t.download="snapshot.jpg",t.click(),t.remove()})(document.createElement("a"),document.body),r.play(),a.remove("c"));var Oe=e=>{var t=r.src,m=document.createElement("a");return _.a=null,v.removeEventListener("click",k),r.removeEventListener("pause",x),r.removeEventListener("play",g),document.body.appendChild(m),m.href=t,m.download="a.webm",m.click(),m.remove(),r.src="",URL.revokeObjectURL(t),h.textContent="0:00",r.srcObject=o.stream,r.play(),a.remove("c")};var M=[Se,Oe];var Te=e=>(r.play(),a.remove("c"));var Ve=e=>(_.a=null,v.removeEventListener("click",k),r.removeEventListener("pause",x),r.removeEventListener("play",g),URL.revokeObjectURL(r.src),r.src="",r.srcObject=o.stream,h.textContent="0:00",r.play(),a.remove("c"));var N=[Te,Ve];var je=e=>(e.classList.add("a"),e.style.left="64px",(e=e.nextElementSibling).style.left="128px",e.classList.remove("a"),a.remove("d"));var we=e=>(e.classList.add("a"),e.style.left="64px",(e=e.previousElementSibling).style.left="0px",e.classList.remove("a"),a.add("d"));var V=[je,we];var $=e=>{var t=e.currentTarget,m=t.getAttribute("data-a"),l=d.m;return m===l||(localStorage.setItem("3",(d.m=m).toString()),V[j(m,l)](t))};var j=(e,t)=>(F.removeEventListener("click",R[t]),F.addEventListener("click",R[e]),z.removeEventListener("click",M[t]),z.addEventListener("click",M[e]),G.removeEventListener("click",N[t]),G.addEventListener("click",N[e]),e);var A=e=>{var t=u.exact,m=n.exact,l=!1,i=e.length,c=0,y="",H="",f=null,P=o.o;if(P.audio)e:{if(m){for(;c<i;c++)if((f=e[c]).kind==="audioinput"&&f.deviceId===m){E.remove("hi");break e}c=0}for(;c<i;c++)if((f=e[c]).kind==="audioinput"){localStorage.setItem("4",d.md=n.exact=f.deviceId),E.remove("hi");break}c=0,E.add("hi"),P=o.o=B}else E.add("hi");e:{if(t){for(;c<i;c++)if((f=e[c]).kind==="videoinput"&&f.deviceId===t){l=!0;break e}c=0}for(;c<i;c++)if((f=e[c]).kind==="videoinput"){l=!0,localStorage.setItem("2",d.vd=u.exact=f.deviceId);break}}return l?navigator.mediaDevices.getUserMedia(P).then(re).catch(console.error):console.error("NOT_FOUND_DEVICES")};var Z=e=>(e.getTracks().reduce(p,e),u.exact=d.vd,navigator.mediaDevices.enumerateDevices());var ne=e=>_.a.push(e.data);var me=()=>w.remove("b");var ce=e=>{var t=e.length,m=null;if(e.reduce(K,0)>1){for(var l=null,i=0,c=0,y=u.exact,H="";i<t;i++)if(y===e[i].deviceId){i++;t:for(var f=t-1;i<t;i++)if((l=e[i]).kind==="videoinput"){localStorage.setItem("2",u.exact=l.deviceId);break t}else i===f&&(i=-1);m=navigator.mediaDevices.getUserMedia(o.o).then(te).catch(console.error);break}}return m};var le=e=>{var t=r.srcObject;return t.getAudioTracks().reduce(p,t),e.getAudioTracks().reduce(T,t),e.getVideoTracks().reduce(p,e),document.querySelector("#cm_aud .audv > button.a").classList.remove("a"),o.T.add("a")};var se=e=>{W.innerHTML="";for(var t=n.exact,m="",l=null,i=null,c=null,y=0,H=e.length;y<H;y++)(l=e[y]).kind==="audioinput"&&((c=(i=xe.cloneNode(!0)).querySelector("button")).querySelector("span").textContent=l.label,(m=l.deviceId)===t&&c.classList.add("a"),c.setAttribute("data-a",m),c.onclick=ie,W.appendChild(i));L.add("a")};(e=>{var t=d.m;return e.getElementById("cm_ca").onclick=fe,e.getElementById("cm").onclick=ue,e.getElementById("cm_sw").onclick=ae,cm_pa.onclick=oe,e.getElementById("cm_fi").onclick=de,cm_au.onclick=pe,e.querySelectorAll("#cm_mo > button").forEach(m=>m.onclick=$),V[j(t,-1)](e.querySelector(`#cm_mo>:nth-child(${1+t})`))})(document);})();
//# sourceMappingURL=1.js.map
